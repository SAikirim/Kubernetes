# 01. 컨테이너와 쿠버네티스

---
## 1.1 컨테이너의 개요

---
#### 1. 컨테이너란? 
* 호스트 OS 상에 논리적인 구획(컨테이너)을 만들고, 컨테이너 안에 필요한 것들을 모아, 전용 서버인 것 처럼 만듦
* 서버 가상화와 비교하여 가볍고 속도가 빠름
	- 호스트형 서버 가상화 : 호스트OS 상에 여러 게스트 OS를 작동, 오버헤드가 매우 커짐
	- 하이퍼바이저형 서버 가상화 : 호스트OS가 없이 여러 가상OS를 만듬, 리소스를 효율적으로 사용하지만 가상환경 시작시 오버헤드가 커짐

---
#### 2. 컨테이너 어플리케이션 개발의 흐름
* 일반적인 웹 시스템 개발 시 필요한 어플리케이션
	- 어플리케이션 실행 모듈
	- 미들웨어나 라이브러리
	- OS/네트워크와 같은 인프라 환경 설정
	
* 기존 어플리케이션 개발 : 개발 환경 -> 테스트 환경 -> 스테이징 환경 -> 실제 환경
	- 테스환경에서 올바르게 작동해도 스테이징 환경 및 실제 환경에서 작동 안 할수 있음
	- 스테이징 환경 : 개발한 어플리케이션을 실제 환경에 배포하기 직전에 확인하는 환경
* 개발한 어플리케이션의 실행에 필요한 모든 것이 포함된 컨테이너 이미지 작성
	- 다른 환경에서 안 될 위험을 줄임
	
##### 컨테이너 어플리케이션 빌드(build)
* 도커 이미지 : 어플리케이션의 실행에 필요한 파일들이 저장되어 있는 디렉터리
* 하나의 이미지에는 하나의 어플리케이션만 넣고, 여러 컨테이너를 조합하여 서비스 구축을 권장

##### 컨테이너 이미지 공유(Ship)
* 컨테이너 이미지는 레지스트리로 공유 가능
	- Docker Hub

##### 컨테이너 어플리케이션 실행(Run)
* 하나의 이미지로 여러 개의 컨테이너 작동 가능
* 프로세스를 하나의 그룹으로 관리

---
## 1.2 쿠버네티스의 개요

---
#### 1. 분산 환경에서 컨테이너 운용 관리
* 멀티호스트로 구성된 클러스터를 통합 관리하려면 컨테이너 오케스트레이션 툴이 필요

* 쿠버네티스
	- Cloud Native Computing Foundation(CNCF)이 개발 지원하는 오픈소스 컨테이너 오케스트레이션 툴
	- 제공 기능 풍부, 대규모 시스템에 도입 실적 풍부, 실질적인 스탠다드
* 도커(Swarm 모드)
	- Swarm 모드 : Docker에서 제공하는 클러스터링 기능
	- 여러 개의 컨테이너를 멀티호스트 환경에서 작동, 그 컨테이너들을 모아서 하나의 명령으로 조작
* Apache Mesos/Marathon
	- 오픈소스 컨테이너 오케스트레이션 툴
	- 대규모 클러스터 지원
	- 여러 호스트의 CPU, 메모리, 디스크를 추상화하여 하나의 리소스 풀로 다룰 수 있는 특징
    => Marathon 이라는 별도의 컨테이너 관리용 프레임워크가 필요
	
---
#### 2. 쿠버네티스의 특징
* 대규모 분산 환경에서 소수의 엔지니어만으로 컨테이너 어플리케이션을 관리하는 것을 목적으로한 오케스트레이션 툴
* 구글 Brog에서 2015년 7월(버전 1.0)이 된 시점에 Linux Foundation 산하의 CNCF로 이관
* '시스템이 원래 되어 있어야 할 모습'을 정의 파일로 설정(선언적 설정)하여, 장애가 발생해도 사람의 개입없이 자동 수습 가능
* 주요 기능	
    - 여러 서버에서의 컨테이너 관리
	- 컨테이너 배포
    - 컨테이너 간 네트워크 관리
    - 컨테이너의 부하분산
    - 컨테이너의 감시
    - 컨테이너 업데이트
	- 장애 발생 시 자동 복구

##### Cloud Native Computing Foundation(CNCF)
* 최첨단 클라우드 네이티브 컴퓨팅을 누구나 사용할 수 있도록하고 지속 가능하도록 하는 것이 목적
* Lunux Foundation 산하이며 AWS, Google, Microsoft, RedHat, Docker, CoreOS 등 주요 기업이 맴버로 참여

---
#### 3. 쿠버네티스의 도입
* 온프레미스 환경에 도입 -> 하드웨어나 네트워크에 대한 지식이 필요
* 클라우드의 가상 머신 인스턴트 구축 -> 인프라 환경 구축, 오케스트레이션 툴, 감시 툴 사용법, 시스템 운용 및 장애 대응 등 지식이 필요
    - 운영 난이도가 높음
* 퍼블릭 클라우드가 제공하는 '매니지드 서비스' 이용
    - 클러스터 버전업, 하드웨어 메인터넌스 작업 등 운영의 작업적인 부하를 경감
    - 어플리케이션 개발, Docker 이미지 작성 및 실행, 테스트 등 개발 업무 주력 가능

* Amazon Elastic Container Service for Kubernetes(Amazon EKS)
	- Amazon Web Serveices가 제공하는 쿠버네티스 매니지드 서비스
	- IAM과 Kubernetes RBAC을 연결 가능
	- VPC 보안 그룹 및 네트워크 ACL 사용 가능
	- EKS : https://aws.amazon.com/ko/eks/
* Google Kubernetes Engine(GKE)
	- 구글이 제공하는 쿠버네티스 매니지드 서비스
	- 자사가 제공(지메일, 유튜브 등)하는 서비스를 컨테이너로 운용
	- 클러스터 자동 스케일
	- GKE : https://cloud.google.com/kubernetes-engine
* Azure Kubernetes Service(AKS)
	- 마이크로소프트가 제공하는 Azure의 컨테이너 매니지드 서비스
	- 개발자용 기능에 보다 힘을 쏟고 있음
	- 컨테이너 배포 지원 툴인 Helm이나 Drft의 개발을 리드
	- AKS : https://azure.microsoft.com/ko-kr/services/kubernetes-service/
	
---
#### 4. 쿠버네티스의 유스케이스
* 기존 어플리케이션의 이전
![기존 어플리케이션의 이전 패턴](.\01. 컨테이너와 쿠버네티스\kubernetes_00_aks이전패턴.png)[^출처]
	- 온프레미스 환경에서 실제로 운용 중인 어플리케이션을 컨테이너로 이전시 쿠버네티스 사용
	- Azure의 경우 레지스트리로는 Azure Container Registry를 이용
	- Azure Active Directory의 통합 및 액세스 제어
	- Azure Database for MySQL 등 외부 데이터스토어를 통해 영구 데이터 관리
* 마이크로 서비스의 운용 관리
![마이크로 서비스 운용 관리 패턴](.\01. 컨테이너와 쿠버네티스\kubernetes_01_aks마이크로서비스운용관리패턴.png)[^출처2]
	- 마이크로 서비스형 어플이케이션을 쿠버네티스에 이용
	- 수평 스케일링, 자기 복구, 부하 분산 등과 같은 기능을 활용 가능
* IoT 디바이스의 전개와 관리
![IoT 디바이스 전개와 관리 패턴](.\01. 컨테이너와 쿠버네티스\kubernetes_02_IoT디바이스전개와관리패턴.png)[^출처3]
	- 몇 백 ~ 몇 만이나 되는 IoT 디바이스 필요
	- 쿠버네티스를 사용하여 클라우드 또는 온프레미스에서 실행되는 IoT 디바이스에 대해 필요한 컴퓨팅 리소스를 온디맨드로 제공 가능
* 기계학습의 워크로드
![기계학습 모델 트레이닝 패턴](.\01. 컨테이너와 쿠버네티스\kubernetes_03_기계학습모델트레이닝패턴.png)[^출처4]
	- 쿠버네티스를 활용하여 컴퓨팅 리소스를 효과적으로 활용
	- 대규모 데이터셋을 사용하여 파라미터 서버나 분산 학습을 위한 위커노드(walker node) 관리 가능
	- Kubeflow 등과 같은 툴을 사용하여 기계학습 환경 구축 가능

## 1.3 정리
* 컨테이너의 개요의 어플리케이션 개발의 흐름
* 분산 환경에서 컨테이너 어플리케이션 운용 관리
* 쿠버네티스의 개요

---
[^출처]: https://azure.microsoft.com/ko-kr/solutions/architecture/migrate-existing-applications-with-aks/
[^출처2]: https://azure.microsoft.com/ko-kr/solutions/architecture/microservices-with-aks/
[^출처3]: https://azure.microsoft.com/ko-kr/solutions/architecture/iot-with-aks/
[^출처4]: https://azure.microsoft.com/ko-kr/solutions/architecture/machine-learning-with-aks/
