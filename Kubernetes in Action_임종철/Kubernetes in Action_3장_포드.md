# Kubernetes in Action

---
---
## 3장 포드： 쿠버네티스에서 컨테이너 실행하기

---
---
### 3.1 포드 소개

---
---
### 3.2 YAML이나 JSON 파일 디스크립터에서 포드 만들기

---
---
### 3.3 라벨을 이용한 포드 구성

---
---
### 3.4 라벨 셀렉터를 통한 하위 집합 나열하기

---
---
### 3.5 포드 스케줄링 제약을 위한 라벨과 셀렉터의 사용

---
---
### 3.6 포드에 주석 달기

---
---
### 3.7 그룹 리소스의 네임스페이스 사용하기
* 쿠버네티스 네임스페이스는 객체 이름의 범위를 제공
	- 동일한 리소스 이름을 여러 네임스페스스에서 여러 번 사용할 수 있음
	
	
---
#### 3.7.1 네임스페이스의 필요성
1. 많은 구성 요소를 포함하는 복잡한 시스템을 더 작은 그룹으로 분할할 수 있음
2. 멀티 테넌트(Multi-tenant) 환경에서 리소스를 분리하고 리소스를 생산, 개발 및 QA환경으로 또는 기타 필요한 방식으로 분할하는 데 사용할 수 있음
3. 네임스페이스를 사용하면 함께 속하지 않는 리소스를 겹치지 않는 그룹으로 분리할 수 있음
	- 모든 리소스가 기본 네임스페이스에 속할 경우, 
		+ 직접 생성한 리소스와 섞여, 어디에 속해 있는지 리소스 확인이 어렵데 됨
		+ 실수로 시스템 리소스를 삭제할 수 있음

###### 멀티 테넌시(Multi-tenancy) 및 멀티 테넌트(Multi-tenant)
* 멀티 테넌시
  - 그 용어에서 유추할 수 있듯 여러 테넌트(tenant, 사용자)를 가진 아키텍처라는 의미
  - __하나의 시스템과 소프트웨어를 여러 사용자가 공유하는 구조__
	+ __하나의 Software Instance 가 하나의 서버 위에서 여러 개의 Tenant 를 서비스 한다는 의미__
  - 많은 사람이 같은 기능을 사용하는 웹메일 서비스가 대표적인 멀티테넌시 아키텍처 소프트웨어
  - 중요한 것은 각 사용자가 독립적으로 이용할 수 있어야 한다는 점

* 장점
  - 비용 절감
  - 데이터 통합이 쉽다

* 단점
  - 개인화를 지원하기 위해서는 더 정교한 멀티테턴시 아키텍처를 적용해야 하는데 이를 개발하는 입장에서는 상당한 비용과 인력이 필요
  - 업데이트 과정에서 자칫 버그나 장애가 발생하면, 모든 사용자가 공통으로 장애를 겪을 수 있음 
  - 일부 사용자에게 유용한 업데이트가 다른 사용자에게는 오히려 불편함을 유발
  - 보안 문제
    + 외부적으로는 사용자별로 다른 것처럼 보인다고 해도 결국 멀티테넌시 아키텍처 내부적으로는 단일 데이터베이스에 다양한 사용자의 데이터가 공존
       * 사용자별 데이터가 섞이지 않도록해야 함
       * 해킹이 발생시, 모든 사용자의 데이터가 유출되지 않도록 해야함
*  테넌트
  - 소프트웨어 인스턴스에 대해 공통이 되는 특정 접근 권한을 공유하는 __사용자__들
  
* 멀티 테넌트 구조에서 Software 들은 모든 테넌트들에 대해 인스턴스의 일부분을 단독적으로 제공하기 위하여 설계되어 있음

---
#### 3.7.3 네임스페이스 만들기

##### YAML 파일로 네임스페이스 만들기
Ex) 네임스페이스 YAML 정의(custom-namespace.yaml)
```yaml
apiVersion: v1
kind: Namespace				# 네임스페이스를 정의했다는 의미
metadata:
  name: custom-namespace	# 네임스페이스의 이름
```
* 네임스페이스 작성
	- `$ kubectl create -f custom-namespace.yaml`

##### kubectl create namespace로 네임스페이스 생성
```bash
$ kubectl create namespace custom-namespace
```

---
#### 3.7.4 다른 네임스페이스의 객체 관리
* 생성한 네임스페이스에 리소스를 만들려면 
	- namespace:custom-namespace 항목을 메타 데이터 섹션에 추가
	- kubectl create 명령을 사용해 리소스를 만들 때 네임스페이스를 지정

Ex) 네임스페이스 지정
```bash
$ kubectl create -f kubia-manua1.yaml -n custom-namespace
```
* 네임스페이스를 지정하지 않으면 kubectl 컨텍스트에 구성된 기본 네임스페이스에서 작업을 수행함
* 현재의 컨텍스트의 네임스페이스와 컨텍스트 자체는 `kubectl config` 명령을 통해 변경할 수 있음

```
팁 : 다른 네임스페이스로 빠르게 전환하려면 다음과 같은 별칭(alias kcd='kubectl config set-context 
$(kubectl config currentcontext) --namespace')을 설정할 수 있다. 그다음 kcd somenamespace를
사용해 네임스페이스 간의 전환이 가능하다．
```

---
#### 3.7.5 네임스페이스가 제공하는 격리
* 네임스페이스를 사용하면 객쳬를 별개의 그룹으로 격리할 수 있지만,
	- 지정된 네임스페이스에 속한 객쳬만 조작할 수 있으므로 실행 중인 객쳬를 격리하지 않음
* Ex) 서로 다른 사용자가 서로 다른 네임스페이스에 포드를 배치하면 포드는 서로 격리되어 통신할 수 없지만 반드시 그런 것은 또 아님
	- 네트워크 격리를 제공하는지 여부는 쿠버네티스와 함께 배포되는 네트워킹 솔루션에 따라 다름
	- 솔루션이 네임스페이스 간 네트워크 격리를 제공하지 않는 경우,
		+ 다른 네임스페이스에 속한 포드의 주소를 알고 있어, HTTP 요청과 같은 트래픽을 다른 포드로 보내는 것을 막을 방법이 없음


---
---
### 3.8 포드의 중지와 삭제



---
---
### 3.9 요약
* 

---
## 출처
[^출처]: Kubernetes in Action-마르코 룩샤-에이콘


<!-- ![](./Kubernetes in Action_3장_포드/) -->