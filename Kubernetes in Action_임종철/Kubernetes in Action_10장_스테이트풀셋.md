# Kubernetes in Action

---
---
## 10장 스테이트풀셋：복제된 스테이트풀 어플리케이션 배포하기

---
### 10.1 스테이트풀 포드 복제
* 레플리카셋은 단일 포드 템플릿에서 여러 포드 복제본을 생성
	- 복제본은 이름과 IP주소만 다를 뿐 나머지는 똑같음
	- 레플리카셋의 모든 복제본은 동일한 PersistentVolumeClaim을 사용
		+ 그러므로 클레임에 바인딩된 동일한 PersistentVolume을 사용
		
![레플리카셋](./Kubernetes in Action_10장_스테이트풀셋/10장_00_레플리카셋.png)

---
#### 10.1.1 각 포드가 분리된 저장소를 갖도록 여러 복제본 실행
* 한 포드의 복제본을 여러 개 실행하고, 각 포드별 자체 스토리지 볼륨을 설정하려면?
	- 레플리카셋 안됨

##### 수동으로 포드 생성
* 레플리카셋이 관리 안함
* 수동 관리 필요
* 사라지면 직접 재생성 필요
	- 좋은 해결책 아님

##### 포드 인스턴스마다 하나의 레플리카셋 사용
* 레플리카셋 본제본 1개에, 여러 레플리카셋 만들기
	- 단일 레플리카셋에 비해 훨씬 번거로움
	- 최선의 방법은 아님

##### 같은 볼륨에서 여러 개의 디렉터리 사용
* 모든 포드가 같은 PersistentVolume을 사용하지만, 각 포드의 볼륨 안에 별도의 파일 디렉터리를 사용
	- 각 인스턴스에 사용해야 하는 디렉터리를 지정할 수는 없지만, 각 인스턴스가 해당 시간에 사용하지 않는 데이터 디렉터리를 자동으로 선택(가능한 경우 생성)하게 할 수는 있음
		+ 인스턴스 간에 조정이 필요하며 올바르게 수행하기 힘듬
		+ 또한 공유 스토리지 볼륨에 병목현상이 발생
		
![디렉터리 분리](./Kubernetes in Action_10장_스테이트풀셋/10장_01_디렉터리분리.png)

---
#### 10.1.2 각 포드에 안정적인 ID 제공
* 특정 클러스터 애플리케이션은 각 인스턴스가 장기간 안정적인 ID를 가져야 함
* 레플리카셋이 포드를 대쳬하면 포드는 호스트 이름과 IP가 다른 완전히 새로운 포드가 됨
	- 완전히 새로운 네트워크 ID로 인해 문제가 발생할 수 있음

* 안정적인 네트워크 ID를 요구하는 이유
	- 특정 앱에서는 관리자가 모든 클러스터 멤버와 각 멤버의 구성 파일에 해당 IP 주소(또는 호스트 이름)를 나열해야 함
	- 쿠버네티스에서는 새로운 포드로 인하여, 전체 어플리케이션 클러스터를 재구성해야 함

##### 각 포드 인스턴스에 전용 서비스 사용
* 각 구성원마다 전용 쿠버네티스 서비스를 만들어 클러스터 구성원에게 안정적인 네트워크 주소를 제공하는 방법
	- 개별 포드는 자신이 어떤 서비스를 통해 노출되는지 알 수 없음
		+ 따라서 안징적인 IP를 알 수 없음
	- IP를 사용하는 포드에서 자동으로 등록할 수 없음
	- 좋은 해결 방법이 아님
		+ 스테이트풀셋을 사용해 해결하길 권장
	
![전용 서비스 사용](./Kubernetes in Action_10장_스테이트풀셋/10장_02_전용서비스사용.png)



---
---
### 10.2 스테이트풀셋 이해

---
#### 10.2.1 스테이트풀셋과 레플리카셋 비교 

---
#### 10.2.2 안적적인 네트워크 ID 제공

---
#### 10.2.3 각 스테이트풀 인스턴스에 안정적인 전용 스토리지 제공

---
#### 10.2.4 스테이트풀셋의 보장

---
---
### 10.3 스테이트풀셋 사용

---		
#### 10.3.1 앱 및 컨테이너 이미지 만들기

---
#### 10.3.2 스테이트풀 셋을 통한 어플리케이션 배포

---
#### 10.3.3 실제로 포드를 동작해보기

---
---
### 10.4 스테이트풀셋에서 피어 발견

---
#### 10.4.1 DNS를 통한 피어 검색 구현

---
#### 10.4.2 스테이트풀셋 업데이트

---
#### 10.4.3 클러스터된 데이터 스토리지 사용

---
---
### 10.5 스테이트풀셋이 노드 장애를 처리하는 방법

---
#### 10.5.1 네트워크에서 노드 연결 해제 시뮬레이션

---
#### 10.5.2 수동으로 포드 삭제

---
---
### 10.6 요약


---
## 출처
[^출처]: Kubernetes in Action-마르코 룩샤-에이콘


<!-- ![](./Kubernetes in Action_6장_스테이트풀셋/) -->